class Progress{constructor(t={}){this.timestamp=null,this.duration=t.duration||Progress.CONST.DURATION,this.progress=0,this.delta=0,this.progress=0,this.isLoop=!!t.isLoop,this.reset()}static get CONST(){return{DURATION:1e3}}reset(){this.timestamp=null}start(t){this.timestamp=t}tick(t){return this.timestamp?(this.delta=t-this.timestamp,this.progress=Math.min(this.delta/this.duration,1),this.progress>=1&&this.isLoop&&this.start(t),this.progress):0}}class Confetti{constructor(t){this.parent=t.elm||document.body,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.width=t.width||this.parent.offsetWidth,this.height=t.height||this.parent.offsetHeight,this.length=t.length||Confetti.CONST.PAPER_LENGTH,this.yRange=t.yRange||2*this.height,this.progress=new Progress({duration:t.duration,isLoop:!0}),this.rotationRange="number"==typeof t.rotationLength?t.rotationRange:10,this.speedRange="number"==typeof t.speedRange?t.speedRange:10,this.sprites=[],this.canvas.classList.add("paper_winning"),this.canvas.style.cssText=["display: block","position: fixed","top: 0","left: 0","pointer-events: none"].join(";"),this.render=this.render.bind(this),this.build(),this.parent.appendChild(this.canvas),this.progress.start(performance.now()),requestAnimationFrame(this.render)}static get CONST(){return{SPRITE_WIDTH:9,SPRITE_HEIGHT:16,PAPER_LENGTH:100,DURATION:8e3,ROTATION_RATE:50,COLORS:["#EF5350","#EC407A","#AB47BC","#7E57C2","#5C6BC0","#42A5F5","#29B6F6","#26C6DA","#26A69A","#66BB6A","#9CCC65","#D4E157","#FFEE58","#FFCA28","#FFA726","#FF7043","#8D6E63","#BDBDBD","#78909C"]}}build(){for(let t=0;t<this.length;++t){let t=document.createElement("canvas"),s=t.getContext("2d");t.width=Confetti.CONST.SPRITE_WIDTH,t.height=Confetti.CONST.SPRITE_HEIGHT,t.position={initX:Math.random()*this.width,initY:-t.height-Math.random()*this.yRange},t.rotation=this.rotationRange/2-Math.random()*this.rotationRange,t.speed=this.speedRange/2+Math.random()*(this.speedRange/2),s.save(),s.fillStyle=Confetti.CONST.COLORS[Math.random()*Confetti.CONST.COLORS.length|0],s.fillRect(0,0,t.width,t.height),s.restore(),this.sprites.push(t)}}render(t){let s=this.progress.tick(t);this.canvas.width=this.width,this.canvas.height=this.height;for(let t=0;t<this.length;++t)this.ctx.save(),this.ctx.translate(this.sprites[t].position.initX+this.sprites[t].rotation*Confetti.CONST.ROTATION_RATE*s,this.sprites[t].position.initY+s*(this.height+this.yRange)),this.ctx.rotate(this.sprites[t].rotation),this.ctx.drawImage(this.sprites[t],-Confetti.CONST.SPRITE_WIDTH*Math.abs(Math.sin(s*Math.PI*2*this.sprites[t].speed))/2,-Confetti.CONST.SPRITE_HEIGHT/2,Confetti.CONST.SPRITE_WIDTH*Math.abs(Math.sin(s*Math.PI*2*this.sprites[t].speed)),Confetti.CONST.SPRITE_HEIGHT),this.ctx.restore();requestAnimationFrame(this.render)}}